{% extends 'base.html.twig' %}

{% block title %}Bato - Dashboard
{% endblock %}

{% block body %}
	<main role="main">
		<div class="container">

			{% for message in app.flashes('success') %}
				{% if loop.first %}
					<div class="alert alert-success alert-dismissible fade show mt-1" role="alert">
						{{ message }}
						<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
					</div>

					<script>
						setTimeout(function () {
var alert = document.querySelector('.alert');
alert.classList.remove('show');
alert.classList.add('hide');
setTimeout(function () {
alert.remove();
}, 1000);
}, 5000);
					</script>
				{% endif %}
			{% endfor %}

			<div class="row border border-light rounded bg-light m-2 p-1 mt-5">
				{% if app.user %}
					<h1 class="display-3">Bonjour
						{{ app.user.getIDUtilisateur.prenom }}!</h1>
					<h4>Voici un petit récapitulatif de votre journée :</h4>
					<ul
						class="list-unstyled mt-2" style="margin-left: 0.5rem;">
						{# <li class="">Il y a X nouveaux devis.</li> #}

						<li class="list-group-item">
							{% if appelsCurrentUser|length > 0 %}
								<a class="btn btn-secondary" data-bs-toggle="collapse" href="#rdvCollapse" role="button" aria-expanded="false" aria-controls="rdvCollapse">
									{{ appelsCurrentUser|length }}
									rendez-vous aujourd'hui.
								</a>

								<div class="collapse col-md-7" id="rdvCollapse">
									<div class="row rounded bg-white m-2 p-1">
										<ul
											class="list-group list-group-flush" style="max-height: 150px; overflow-y: auto;">
                                                {# {% for appels in appelsCurrentUser|sort((a, b) => a.RDV.dateDebut <=> b.RDV.dateDebut) %}
                                                    {% if appels.RDV.dateDebut >= now %}
                                                        <li class="list-group-item d-flex justify-content-between align-items-center">
                                                            <a class="text-decoration-none link-dark" href="{{ path('app_appels_show', {'id': appels.id}) }}">
                                                                {{ appels.nom }}
                                                            </a>
                                                            <span class="badge bg-primary text-wrap">{{ appels.RDV.dateDebut|date('d/m/Y H:i') }}</span>
                                                        </li>
                                                    {% endif %}
                                                {% endfor %} #}

											{% set hasAppointment = false %}
											{% for appels in appelsCurrentUser|sort((a, b) => a.RDV.dateDebut <=> b.RDV.dateDebut) %}
												{% if appels.RDV.dateDebut|date_modify('+1 hour') >= now %}
													{% set hasAppointment = true %}
													<li class="list-group-item d-flex justify-content-between align-items-center">
														{% if appels.RDV.dateDebut|date_modify('+1 hour') >= now %}
															<a class="text-decoration-none link-dark" href="{{ path('app_appels_show', {'id': appels.id}) }}">{{ appels.nom }}</a>
														{% else %}
															{{ appels.nom }}
														{% endif %}
														<span class="badge bg-primary text-wrap">{{ appels.RDV.dateDebut|date('d/m/Y H:i') }}</span>
													</li>
												{% endif %}
											{% endfor %}
											{% if not hasAppointment %}
												<li class="list-group-item">Plus aucun rendez-vous pour aujourd'hui !</li>
											{% endif %}

										</ul>
									</div>
								</div>
							{% else %}
								Aucun rendez-vous aujourd'hui.
							{% endif %}
						</li>
					</ul>
				{% endif %}
			</div>

			<div class="row border border-light rounded bg-light m-2 p-2">
				<h1 class="display-3">Calendrier</h1>
				<div class="row">
					<div class="col calendar-holder p-2" id="calendar-holder-dashboard-0" data-events-url="{{ path('fc_load_events') }}"></div>
				</div>
				<div class="row">
					<div class="col calendar-holder calendar-holder-rest" id="calendar-holder-dashboard-1" data-events-url="{{ path('fc_load_events') }}"></div>
					<div class="col calendar-holder calendar-holder-rest" id="calendar-holder-dashboard-2" data-events-url="{{ path('fc_load_events') }}"></div>
					<div class="col calendar-holder calendar-holder-rest" id="calendar-holder-dashboard-3" data-events-url="{{ path('fc_load_events') }}"></div>
					<div class="col calendar-holder calendar-holder-rest" id="calendar-holder-dashboard-4" data-events-url="{{ path('fc_load_events') }}"></div>
				</div>
			</div>
			<!-- Devis à réaliser -->
			<div class="row border border-light rounded bg-light m-2 p-2">
				<h1 class="display-3">Devis à réaliser</h1>
				<div class="col-md-4">
					<h2>Devis 1</h2>
					<p>Donec id elit non mi porta gravida at eget metus. Fusce dapibus, tellus ac cursus commodo, tortor mauris condimentum nibh, ut fermentum massa justo sit amet risus. Etiam porta sem malesuada magna mollis euismod. Donec sed odio dui.
					</p>
					<p>
						<a class="btn btn-secondary" href="#" role="button">View details »</a>
					</p>
				</div>
				<div class="col-md-4">
					<h2>Devis 2</h2>
					<p>Donec id elit non mi porta gravida at eget metus. Fusce dapibus, tellus ac cursus commodo, tortor mauris condimentum nibh, ut fermentum massa justo sit amet risus. Etiam porta sem malesuada magna mollis euismod. Donec sed odio dui.
					</p>
					<p>
						<a class="btn btn-secondary" href="#" role="button">View details »</a>
					</p>
				</div>
				<div class="col-md-4">
					<h2>Devis 3</h2>
					<p>Donec sed odio dui. Cras justo odio, dapibus ac facilisis in, egestas eget quam. Vestibulum id ligula porta felis euismod semper. Fusce dapibus, tellus ac cursus commodo, tortor mauris condimentum nibh, ut fermentum massa justo sit amet risus.</p>
					<p>
						<a class="btn btn-secondary" href="#" role="button">View details »</a>
					</p>
				</div>
			</div>

			<!-- Chantier client -->
			<div class="row border border-light rounded bg-light m-2 p-2">
				<h1 class="display-3">Chantier client</h1>
				<div class="col-md-4">
					<h2>1</h2>
					<p>Donec id elit non mi porta gravida at eget metus. Fusce dapibus, tellus ac cursus commodo, tortor mauris condimentum nibh, ut fermentum massa justo sit amet risus. Etiam porta sem malesuada magna mollis euismod. Donec sed odio dui.
					</p>
					<p>
						<a class="btn btn-secondary" href="#" role="button">View details »</a>
					</p>
				</div>
				<div class="col-md-4">
					<h2>2</h2>
					<p>Donec id elit non mi porta gravida at eget metus. Fusce dapibus, tellus ac cursus commodo, tortor mauris condimentum nibh, ut fermentum massa justo sit amet risus. Etiam porta sem malesuada magna mollis euismod. Donec sed odio dui.
					</p>
					<p>
						<a class="btn btn-secondary" href="#" role="button">View details »</a>
					</p>
				</div>
				<div class="col-md-4">
					<h2>3</h2>
					<p>Donec sed odio dui. Cras justo odio, dapibus ac facilisis in, egestas eget quam. Vestibulum id ligula porta felis euismod semper. Fusce dapibus, tellus ac cursus commodo, tortor mauris condimentum nibh, ut fermentum massa justo sit amet risus.</p>
					<p>
						<a class="btn btn-secondary" href="#" role="button">View details »</a>
					</p>
				</div>
			</div>

			<!-- SAV -->
			<div class="row border border-light rounded bg-light m-2 p-2">
				<h1 class="display-3">SAV</h1>
				<div class="col-md-4">
					<h2>SAV 1</h2>
					<p>Donec id elit non mi porta gravida at eget metus. Fusce dapibus, tellus ac cursus commodo, tortor mauris condimentum nibh, ut fermentum massa justo sit amet risus. Etiam porta sem malesuada magna mollis euismod. Donec sed odio dui.
					</p>
					<p>
						<a class="btn btn-secondary" href="#" role="button">View details »</a>
					</p>
				</div>
				<div class="col-md-4">
					<h2>SAV 2</h2>
					<p>Donec id elit non mi porta gravida at eget metus. Fusce dapibus, tellus ac cursus commodo, tortor mauris condimentum nibh, ut fermentum massa justo sit amet risus. Etiam porta sem malesuada magna mollis euismod. Donec sed odio dui.
					</p>
					<p>
						<a class="btn btn-secondary" href="#" role="button">View details »</a>
					</p>
				</div>
				<div class="col-md-4">
					<h2>SAV 3</h2>
					<p>Donec sed odio dui. Cras justo odio, dapibus ac facilisis in, egestas eget quam. Vestibulum id ligula porta felis euismod semper. Fusce dapibus, tellus ac cursus commodo, tortor mauris condimentum nibh, ut fermentum massa justo sit amet risus.</p>
					<p>
						<a class="btn btn-secondary" href="#" role="button">View details »</a>
					</p>
				</div>
			</div>

			<!-- Appels -->

		</div>
	</main>
{% endblock %}

{% block stylesheets %}
	{{ parent() }}
	{{ encore_entry_link_tags('calendrierDashboard') }}
{% endblock %}

{% block javascripts %}
	{{ parent() }}
	{{ encore_entry_script_tags('calendrierDashboard') }}
{% endblock %}

